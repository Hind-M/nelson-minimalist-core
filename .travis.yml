sudo: required
dist: trusty
language: cpp

cache:
  directories:
    - ${TRAVIS_BUILD_DIR}/deps

matrix:
  include:
    - compiler: gcc
      addons:
        apt:
          sources:
            - ubuntu-toolchain-r-test
          packages:
            - g++-6
      env: COMPILER=g++-6 TEST_CXX14=true BOOST_VERSION=1.61.0

before_install:
  - sudo add-apt-repository --yes ppa:beineri/opt-qt551-trusty
  - sudo apt-get update -qq
  - sudo apt-get install libboost-dev
  - sudo apt-get install pkg-config
  - sudo apt-get install cmake
  - sudo apt-get install libffi-dev
  - sudo apt-get install libicu-dev
  - sudo apt-get install libxml2-dev
  - sudo apt-get -y install qt55base
  - sudo apt-get -y install qt55tools

install:
  - if [ $TRAVIS_OS_NAME == linux ]; then hg clone https://bitbucket.org/eigen/eigen#3.3 /tmp/eigen && mkdir /tmp/eigen-build && cd /tmp/eigen-build && cmake . /tmp/eigen && make && sudo make install && cd -; fi

  - DEPS_DIR="${TRAVIS_BUILD_DIR}/deps"
  - mkdir -p ${DEPS_DIR} && cd ${DEPS_DIR}

  - if [[ "${COMPILER}" != "" ]]; then export CXX=${COMPILER}; fi
  - if [[ "${BOOST_VERSION}" == "default" ]]; then BOOST_VERSION=1.60.0; fi;

  - if [[ ! -d ${DEPS_DIR}/boost ]]; then
      mkdir -p ${DEPS_DIR} && cd ${DEPS_DIR};
      if [[ "${BOOST_VERSION}" == "1.61.0" ]]; then BOOST_URL="http://sourceforge.net/projects/boost/files/boost/1.61.0/boost_1_61_0.tar.gz"; fi;
      if [[ "${BOOST_URL}" != "" ]]; then mkdir boost && travis_retry wget -O - ${BOOST_URL} | tar --strip-components=1 -xz -C boost; fi;
      cd boost/tools/build && ./bootstrap.sh && ./b2 install --prefix=${DEPS_DIR}/b2;
      cd ${TRAVIS_BUILD_DIR};
    fi
  - export PATH=${DEPS_DIR}/b2/bin:${PATH}
  - export BOOST_ROOT=${DEPS_DIR}/boost 

script:
  - source /opt/qt55/bin/qt55-env.sh
  - echo ${COMPILER}
  - echo ${CXX}
  - $CXX --version
  - |-
    JAM="using clang : : ${CXX} ;"

  - echo "With Boost ${BOOST_VERSION}"
  - echo "Travis build directory ${TRAVIS_BUILD_DIR}" 
  - cd ${TRAVIS_BUILD_DIR} 
  - cmake -G "Unix Makefiles"
  - make
  
notifications:
  email: true
